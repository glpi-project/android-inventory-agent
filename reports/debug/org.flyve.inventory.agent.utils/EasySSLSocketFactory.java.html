<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../.resources/report.gif" type="image/gif"/><title>EasySSLSocketFactory.java</title><link rel="stylesheet" href="../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../.sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debugAndroidTest</a> &gt; <a href="index.source.html" class="el_package">org.flyve.inventory.agent.utils</a> &gt; <span class="el_source">EasySSLSocketFactory.java</span></div><h1>EasySSLSocketFactory.java</h1><pre class="source lang-java linenums">package org.flyve.inventory.agent.utils;

/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * &quot;License&quot;); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 * @author olamy
 */

import android.util.Log;

import org.apache.http.conn.ConnectTimeoutException;
import org.apache.http.conn.scheme.LayeredSocketFactory;
import org.apache.http.conn.scheme.SocketFactory;
import org.apache.http.params.HttpConnectionParams;
import org.apache.http.params.HttpParams;

import java.io.IOException;
import java.net.InetAddress;
import java.net.InetSocketAddress;
import java.net.Socket;
import java.net.UnknownHostException;

import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSocket;
import javax.net.ssl.TrustManager;

/**
* This socket factory will create ssl socket that accepts self signed
* certificate
*/
<span class="fc" id="L45">public class EasySSLSocketFactory implements SocketFactory,</span>
        LayeredSocketFactory {

<span class="fc" id="L48">    private SSLContext sslcontext = null;</span>

    /**
     * Create the context of the Easy SSL
     * @return string the context
     * @throws string IOExceptions signals that an I/O exception has occurred
     */
    private static SSLContext createEasySSLContext() throws IOException {
<span class="fc" id="L56">        FlyveLog.log(EasySSLSocketFactory.class,</span>
                &quot;Create Easy SSL Context&quot;, Log.ERROR);
        try {
<span class="fc" id="L59">            SSLContext context = SSLContext.getInstance(&quot;TLS&quot;);</span>
<span class="fc" id="L60">            context.init(null, new TrustManager[] { new EasyX509TrustManager(</span>
                    null) }, null);
<span class="fc" id="L62">            return context;</span>
<span class="nc" id="L63">        } catch (Exception e) {</span>
<span class="nc" id="L64">            throw new IOException(e.getMessage());</span>
        }
    }

    /**
     * Gets the Context of the SSL
     * @return string the context 
     * @throws string IOException signals that an I/O exception has occurred
     */
    private SSLContext getSSLContext() throws IOException {
<span class="pc bpc" id="L74" title="1 of 2 branches missed.">        if (this.sslcontext == null) {</span>
<span class="fc" id="L75">            this.sslcontext = createEasySSLContext();</span>
        }
<span class="fc" id="L77">        return this.sslcontext;</span>
    }

    /**
     * @see org.apache.http.conn.scheme.SocketFactory#connectSocket(java.net.Socket,
     *      java.lang.String, int, java.net.InetAddress, int,
     *      org.apache.http.params.HttpParams)
     */
    @Override
    public Socket connectSocket(Socket sock, String host, int port,
            InetAddress localAddress, int localPort, HttpParams params)
            throws IOException, UnknownHostException, ConnectTimeoutException {
<span class="nc" id="L89">        int connTimeout = HttpConnectionParams.getConnectionTimeout(params);</span>
<span class="nc" id="L90">        int soTimeout = HttpConnectionParams.getSoTimeout(params);</span>
<span class="nc" id="L91">        InetSocketAddress remoteAddress = new InetSocketAddress(host, port);</span>
<span class="nc bnc" id="L92" title="All 2 branches missed.">        SSLSocket sslsock = (SSLSocket) ((sock != null) ? sock : createSocket());</span>

<span class="nc bnc" id="L94" title="All 4 branches missed.">        if ((localAddress != null) || (localPort &gt; 0)) {</span>
            // we need to bind explicitly
<span class="nc bnc" id="L96" title="All 2 branches missed.">            if (localPort &lt; 0) {</span>
<span class="nc" id="L97">                localPort = 0; // indicates &quot;any&quot;</span>
            }
<span class="nc" id="L99">            InetSocketAddress isa = new InetSocketAddress(localAddress,</span>
                    localPort);
<span class="nc" id="L101">            sslsock.bind(isa);</span>
        }

<span class="nc" id="L104">        sslsock.connect(remoteAddress, connTimeout);</span>
<span class="nc" id="L105">        sslsock.setSoTimeout(soTimeout);</span>
<span class="nc" id="L106">        return sslsock;</span>

    }

    /**
     * @see org.apache.http.conn.scheme.SocketFactory#createSocket()
     */
    @Override
    public Socket createSocket() throws IOException {
<span class="nc" id="L115">        return getSSLContext().getSocketFactory().createSocket();</span>
    }

    /**
     * @see org.apache.http.conn.scheme.SocketFactory#isSecure(java.net.Socket)
     */
    @Override
    public boolean isSecure(Socket socket) throws IllegalArgumentException {
<span class="fc" id="L123">        return true;</span>
    }

    /**
     * @see org.apache.http.conn.scheme.LayeredSocketFactory#createSocket(java.net.Socket,
     *      java.lang.String, int, boolean)
     */
    @Override
    public Socket createSocket(Socket socket, String host, int port,
            boolean autoClose) throws IOException, UnknownHostException {
<span class="fc" id="L133">        return getSSLContext().getSocketFactory().createSocket(socket, host,</span>
                port, autoClose);
    }

    // -------------------------------------------------------------------
    // javadoc in org.apache.http.conn.scheme.SocketFactory says :
    // Both Object.equals() and Object.hashCode() must be overridden
    // for the correct operation of some connection managers
    // -------------------------------------------------------------------

    /**
     * Indicates whether some other object is &quot;equal to&quot; this one
     * @param Object obj the reference object with which to compare
     * @return boolean true if the object is the same as the one given in argument
     */
    @Override
    public boolean equals(Object obj) {
<span class="nc bnc" id="L150" title="All 4 branches missed.">        return ((obj != null) &amp;&amp; obj.getClass().equals(</span>
                EasySSLSocketFactory.class));
    }

    /**
     * Returns a hash code value
     * @return int a hash code
     */
    @Override
    public int hashCode() {
<span class="nc" id="L160">        return EasySSLSocketFactory.class.hashCode();</span>
    }

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.5.201505241946</span>Generated by the Android Gradle plugin 2.2.0</div></body></html>